<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>MARTECH CLOUD</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Place favicon.ico in the root directory -->

    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" href="assets/css/bootstrap-5.0.0-beta1.min.css" />
    <link rel="stylesheet" href="assets/css/LineIcons.2.0.css"/>
    <link rel="stylesheet" href="assets/css/tiny-slider.css"/>
    <link rel="stylesheet" href="assets/css/animate.css"/>
    <link rel="stylesheet" href="assets/css/lindy-uikit.css"/>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="module" id="firebase-setup">
      // ‚úÖ Import Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

      // ‚úÖ Your Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyAOjTCwbLka0sfO6eEnfXZmGcwE2yMJwSA",
        authDomain: "scoopx-ice-cream-cafe.firebaseapp.com",
        projectId: "scoopx-ice-cream-cafe",
        storageBucket: "scoopx-ice-cream-cafe.firebasestorage.app",
        messagingSenderId: "800499847619",
        appId: "1:800499847619:web:8008e9016d125f924c2d76"
      };

      // ‚úÖ Initialize Firebase App and Firestore
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // ‚úÖ Expose globally for other scripts
      window.firebaseApp = app;
      window.firebaseDB = db;

      console.log("üî• Firebase (App + Firestore) initialized globally");
    </script>

  <style>
    /* ===== Product Table Styling ===== */
    .product-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
    }

    .product-table thead {
        background: linear-gradient(90deg, #007bff, #6610f2);
        color: #fff;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 13px;
        letter-spacing: 0.5px;
        position: sticky;
        top: 0;
        z-index: 2;
    }

    .product-table th, .product-table td {
        padding: 12px 16px;
        vertical-align: middle;
        border-bottom: 1px solid #f0f0f0;
    }

    .product-table tbody tr:hover {
        background-color: #f8f9fa;
        box-shadow: inset 4px 0 0 #007bff;
        transition: all 0.2s ease-in-out;
    }

    .product-table td img {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        object-fit: cover;
        box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }

    /* Empty state */
    #product-table-body:empty::after {
        content: "No products found.";
        display: block;
        text-align: center;
        padding: 30px;
        color: #999;
        font-style: italic;
    }

    @media (max-width: 768px) {
        .product-table th, .product-table td {
        font-size: 13px;
        padding: 10px;
        }
        .product-table td img {
        width: 40px;
        height: 40px;
        }
    }
    </style>


  </head>
    <body>
    <!-- ========================= preloader start ========================= -->
    <div class="preloader">
        <div class="loader">
        <div class="spinner">
            <div class="spinner-container">
            <div class="spinner-rotator">
                <div class="spinner-left">
                <div class="spinner-circle"></div>
                </div>
                <div class="spinner-right">
                <div class="spinner-circle"></div>
                </div>
            </div>
            </div>
        </div>
        </div>
    </div>
    <!-- ========================= preloader end ========================= -->

    <!-- ========================= hero-section-wrapper-5 start ========================= -->
    <section id="home" class="hero-section-wrapper-5">
        <!-- ========================= header-6 start ========================= -->
        <header class="header header-6">
        <div class="navbar-area">
            <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg" style="border-bottom: 2px solid #E3E3E7;">
                    <a class="navbar-brand" href="https://www.martechcloud.in/home">
                    <img src="assets/img/logo/Martech Cloud Logo2.png" alt="Logo" />
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent6" aria-controls="navbarSupportedContent6" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="toggler-icon"></span>
                    <span class="toggler-icon"></span>
                    <span class="toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent6">
                    <ul id="nav6" class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item me-3">
                        <a class="page-scroll" href="index.html">New Order</a>
                        </li>
                    </ul>

                    <!-- Header Action Icons -->
                    <div class="header-action d-flex align-items-center" style="gap: 15px;">
                        <a href="#0" title="Add Product" class="icon-btn add"><i class="lni lni-upload"></i></a>
                        <a href="#0" title="Delete Product" class="icon-btn delete"><i class="lni lni-trash"></i></a>
                        <a href="#0" title="Billing" class="icon-btn billing"><i class="lni lni-book"></i></a>
                        <a href="#0" title="Login" onclick="googleLogin()" class="icon-btn login"><i class="lni lni-user"></i></a>
                        <a href="#0" title="Logout" onclick="googleLogout()" class="icon-btn logout"><i class="lni lni-exit"></i></a>
                    </div>
                    </div>
                    <!-- navbar collapse -->
                </nav>
                <!-- navbar -->
                </div>
            </div>
            <!-- row -->
            </div>
            <!-- container -->
        </div>
        <!-- navbar area -->
        </header>
        <!-- ========================= header-6 end ========================= -->

        <!-- ========================= product table start ========================= -->
         &nbsp;
         &nbsp;
        <section class="container" style="padding-top: 100px; padding-bottom: 50px;">
        <div class="search-box-wrapper mb-3">
            <div class="search-box input-group">
            <span class="input-group-text bg-light border-end-0">
                <i class="lni lni-search"></i>
            </span>
            <input
                type="text"
                id="tableSearch"
                class="form-control border-start-0 shadow-none"
                placeholder="Search products..."
                onkeyup="filterTable()"
            />
            </div>
        </div>
        <div class="table-responsive">
            <table id="productTable" class="table table-bordered align-middle text-left">
            <thead class="table">
                <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Category</th>
                <th>Price (‚Çπ)</th>
                <th>Quantity</th>
                <th>Unit</th>
                <th>Status</th>
                <th>Barcode</th>
                <th>Per Unit Qty</th>
                <th>Reorder Level</th>
                <th></th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                <tr><td colspan="12" class="text-muted">Loading products...</td></tr>
            </tbody>
            </table>
        </div>
        </section>
        <!-- ========================= product table end ========================= -->

    </section>
    <!-- ========================= hero-section-wrapper-5 end ========================= -->

    <!-- ========================= footer style-4 start ========================= -->
    <footer class="footer footer-style-4">
        <div class="container">
        <div class="copyright-wrapper wow fadeInUp" data-wow-delay=".1s">
            <p>Design and Developed by 
            <a href="https://martechcloud.in" rel="nofollow" target="_blank">Martech Cloud</a>
            </p>
        </div>
        </div>
    </footer>
    <!-- ========================= footer style-4 end ========================= -->

    <!-- ========================= scroll-top start ========================= -->
    <a href="#" class="scroll-top"> <i class="lni lni-chevron-up"></i> </a>
    <!-- ========================= scroll-top end ========================= -->


    <!-- ========================= JS here ========================= -->
    <script src="assets/js/bootstrap-5.0.0-beta1.min.js"></script>
    <script src="assets/js/tiny-slider.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- ========================= Firebase Product Fetch ========================= -->
    <script type="module">
        import {
            getFirestore,
            collection,
            doc,
            onSnapshot,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const db = window.firebaseDB || getFirestore();
        const collectionRef = collection(db, "PRODUCT_DATA_TABLE");

        // üé® Render Table
        function renderTable(products) {
            const tableBody = document.getElementById("productTableBody");

            if (!products || products.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="12" class="text-muted text-center py-3">No products found</td></tr>`;
                return;
            }

            const rows = products
                .map(
                    (prod) => `
                <tr data-id="${prod.id}">
                    <td><img src="${prod.PRODUCT_IMAGE || ""}" alt="${prod.PRODUCT_NAME}" width="50" class="rounded shadow-sm"></td>
                    <td class="editable" data-field="PRODUCT_NAME">${prod.PRODUCT_NAME || "-"}</td>
                    <td class="editable" data-field="PRODUCT_CATEGORY">${prod.PRODUCT_CATEGORY || "-"}</td>
                    <td class="editable" data-field="PRODUCT_PRICE">‚Çπ${prod.PRODUCT_PRICE || "-"}</td>
                    <td class="editable" data-field="PRODUCT_QUANTITY">${prod.PRODUCT_QUANTITY || "-"}</td>
                    <td class="editable" data-field="PRODUCT_UNIT">${prod.PRODUCT_UNIT || "-"}</td>
                    <td class="editable" data-field="IS_ACTIVE">${prod.IS_ACTIVE || "-"}</td>
                    <td class="editable" data-field="BARCODE">${prod.BARCODE || "-"}</td>
                    <td class="editable" data-field="PRODUCT_QUANTITY_PER_UNIT">${prod.PRODUCT_QUANTITY_PER_UNIT || "-"}</td>
                    <td class="editable" data-field="REORDER_LEVEL">${prod.REORDER_LEVEL || "-"}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary fw-semibold edit-btn" data-id="${prod.id}">
                            <i class="lni lni-pencil"></i> Edit
                        </button>
                    </td>
                </tr>`
                )
                .join("");

            tableBody.innerHTML = rows;

            // Attach listeners
            document.querySelectorAll(".edit-btn").forEach((btn) => {
                btn.addEventListener("click", (e) => {
                    const productId = e.currentTarget.getAttribute("data-id");
                    console.log("üñä Editing product:", productId);
                    const row = e.currentTarget.closest("tr");
                    const isEditing = row.classList.contains("editing");

                    if (!isEditing) {
                        enableRowEdit(row);
                    } else {
                        saveRowChanges(row, productId);
                    }
                });
            });
        }

        // ‚úèÔ∏è Enable editing for the row
        function enableRowEdit(row) {
            row.classList.add("editing");
            row.querySelectorAll(".editable").forEach((cell) => {
                const field = cell.dataset.field;
                const text = cell.textContent.trim().replace(/^‚Çπ/, "");

                // Dropdowns for specific fields
                if (field === "PRODUCT_UNIT") {
                    const options = ["LITER", "PIECE", "KG"];
                    const selectHTML = `
                        <select class="form-select form-select-sm">
                            ${options
                                .map(
                                    (opt) =>
                                        `<option value="${opt}" ${
                                            opt === text ? "selected" : ""
                                        }>${opt}</option>`
                                )
                                .join("")}
                        </select>`;
                    cell.innerHTML = selectHTML;

                } else if (field === "IS_ACTIVE") {
                    const options = ["Active", "Deactive"];
                    const selectHTML = `
                        <select class="form-select form-select-sm">
                            ${options
                                .map(
                                    (opt) =>
                                        `<option value="${opt}" ${
                                            opt === text ? "selected" : ""
                                        }>${opt}</option>`
                                )
                                .join("")}
                        </select>`;
                    cell.innerHTML = selectHTML;

                } else {
                    cell.innerHTML = `<input type="text" class="form-control form-control-sm" value="${
                        text === "-" ? "" : text
                    }">`;
                }
            });

            const editBtn = row.querySelector(".edit-btn");
            editBtn.innerHTML = `<i class="lni lni-save"></i> Save`;
            editBtn.classList.remove("btn-outline-primary");
            editBtn.classList.add("btn-success");
        }

        // üíæ Save edited data to Firestore
        async function saveRowChanges(row, productId) {
            const updatedData = {};
            row.querySelectorAll(".editable").forEach((cell) => {
                const field = cell.dataset.field;
                let value = "";

                const input = cell.querySelector("input, select");
                if (input) value = input.value.trim();

                updatedData[field] = value || "";
            });

            updatedData["UPDATED_AT"] = new Date().toISOString();

            try {
                await updateDoc(doc(db, "PRODUCT_DATA_TABLE", productId), updatedData);
                console.log(`‚úÖ Product ${productId} updated successfully.`);

                Swal.fire({
                    icon: "success",
                    title: "Saved!",
                    text: `Product ${productId} updated successfully.`,
                    timer: 1500,
                    showConfirmButton: false,
                });

                // Revert to view mode
                row.classList.remove("editing");
                row.querySelectorAll(".editable").forEach((cell) => {
                    const field = cell.dataset.field;
                    const value = updatedData[field] || "-";
                    if (field === "PRODUCT_PRICE") {
                        cell.textContent = value ? `‚Çπ${value}` : "-";
                    } else {
                        cell.textContent = value;
                    }
                });


                const editBtn = row.querySelector(".edit-btn");
                editBtn.innerHTML = `<i class="lni lni-pencil"></i> Edit`;
                editBtn.classList.remove("btn-success");
                editBtn.classList.add("btn-outline-primary");
            } catch (err) {
                console.error("üî• Error updating product:", err);
                Swal.fire({
                    icon: "error",
                    title: "Update Failed",
                    text: err.message,
                });
            }
        }

        // üîÅ Live Firestore Listener
        function setupLiveListener() {
            onSnapshot(
                collectionRef,
                (snapshot) => {
                    const liveProducts = snapshot.docs.map((doc) => ({
                        id: doc.id,
                        ...doc.data(),
                    }));

                    sessionStorage.setItem("products", JSON.stringify(liveProducts));
                    renderTable(liveProducts);
                    console.log("üü¢ Live data updated.");
                },
                (error) => {
                    console.error("üî• Firestore listener error:", error);
                }
            );
        }

        // üöÄ Init function
        function loadProducts() {
            const cached = sessionStorage.getItem("products");
            if (cached) {
                try {
                    const parsed = JSON.parse(cached);
                    renderTable(parsed);
                    console.log("‚ö° Loaded from session cache.");
                } catch {
                    console.warn("‚ö†Ô∏è Failed to parse cached products.");
                }
            }

            setupLiveListener();
        }

        loadProducts();
    </script>

    <script>
        // üîé Filter function for the table
        function filterTable() {
            const input = document.getElementById("tableSearch");
            const filter = input.value.toLowerCase();
            const table = document.getElementById("productTable");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
            const tds = tr[i].getElementsByTagName("td");
            let rowMatch = false;

            for (let td of tds) {
                if (td.textContent.toLowerCase().includes(filter)) {
                rowMatch = true;
                break;
                }
            }

            tr[i].style.display = rowMatch ? "" : "none";
            }
        }
        </script>






    <style>
        /* üå∏ Table Container */
        .table-responsive {
            overflow-x: auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            background: #fff;
        }

        /* ü©∑ Table Base */
        #productTable {
            width: 100%;
        }

        /* üßÅ Header Styling */
        #productTable th {
            font-size: 13px;
            white-space: nowrap;
            background: linear-gradient(90deg, #D94B86, #D94B86);
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 10px 12px;
            top: 0;
            z-index: 2;
        }

        /* ü™û Data Cells */
        #productTable td {
            font-size: 12.5px;
            vertical-align: middle;
            padding: 8px 10px;
            color: #333;
            background-color: #fff;
            transition: all 0.4s ease;
        }

        /* üñºÔ∏è Product Images */
        #productTable img {
            border-radius: 8px;
            width: 45px;
            height: 45px;
            object-fit: cover;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        #productTable img:hover {
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ü©∂ Row Hover Effect */
      
        #productTable tbody tr:hover {
            background-color: #fff5f8;
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.05), inset 4px 0 0 #D94B86;
        }

        #productTable tbody tr {
            transition: background-color 0.25s ease, box-shadow 0.25s ease;
        }

        /* üñäÔ∏è Editable Inputs */
        .form-control-sm,
        .form-select-sm {
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 12px;
            padding: 4px 6px;
            transition: all 0.2s ease;
        }
        .form-control-sm:focus,
        .form-select-sm:focus {
            border-color: #D94B86;
            box-shadow: 0 0 0 2px rgba(217, 75, 134, 0.25);
        }

        /* ‚ú® Buttons */
        .edit-btn {
            border-radius: 20px;
            font-size: 12px;
            padding: 4px 10px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }
        .edit-btn i {
            font-size: 13px;
        }
        .btn-outline-primary {
            color: #D94B86;
            border-color: #D94B86;
        }
        .btn-outline-primary:hover {
            background-color: #D94B86;
            color: #fff;
        }
        .btn-success {
            background-color: #28a745 !important;
            border-color: #28a745 !important;
        }
        .btn-success:hover {
            background-color: #218838 !important;
        }

        /* üîÅ Editing State Highlight */
        tr.editing {
            background-color: #fff0f5;
            transition: all 0.2s ease-in-out;
        }

        /* üß© Responsive Fixes */
        @media (max-width: 992px) {
            #productTable th,
            #productTable td {
                font-size: 11.5px;
                padding: 6px;
            }
            .edit-btn {
                padding: 3px 8px;
                font-size: 11px;
            }
        }

        @media (max-width: 576px) {
            #productTable img {
                width: 38px;
                height: 38px;
            }
            .table-responsive {
                border-radius: 8px;
            }
            #productTable th {
                font-size: 11px;
                padding: 8px 6px;
            }
            #productTable td {
                font-size: 11px;
            }
        }

        .search-box-wrapper {
            display: flex;
            justify-content: flex-end;
        }

        .search-box {
            width: 280px;
            border-radius: 30px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .search-box input {
            border: none;
            background: #f8f9fa;
            outline: none;
            font-size: 14px;
            padding: 10px 15px;
        }

        .search-box .input-group-text {
            background: #f8f9fa;
            border: none;
            color: #D94B86;
            font-size: 18px;
        }

        /* üì± Responsive design */
        @media (max-width: 768px) {
            .search-box-wrapper {
            justify-content: center;
            width: 100%;
            }

            .search-box {
            width: 100%;
            max-width: 100%;
            border-radius: 20px;
            }

            .search-box input {
            font-size: 13px;
            padding: 8px 12px;
            }
        }
    </style>

    </body>
</html>
