<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>MARTECH CLOUD</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Place favicon.ico in the root directory -->

    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" href="assets/css/bootstrap-5.0.0-beta1.min.css" />
    <link rel="stylesheet" href="assets/css/LineIcons.2.0.css" />
    <link rel="stylesheet" href="assets/css/tiny-slider.css" />
    <link rel="stylesheet" href="assets/css/animate.css" />
    <link rel="stylesheet" href="assets/css/lindy-uikit.css" />
    <link rel="stylesheet" href="pos/posstyle.css" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Setting up the serverside connection -->
    <script type="module" src="setup.js"></script>
  </head>
  <body>
    <!-- ========================= preloader start ========================= -->
    <div class="preloader">
      <div class="loader">
        <div class="spinner">
          <div class="spinner-container">
            <div class="spinner-rotator">
              <div class="spinner-left">
                <div class="spinner-circle"></div>
              </div>
              <div class="spinner-right">
                <div class="spinner-circle"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- ========================= preloader end ========================= -->

    <!-- ========================= hero-section-wrapper-5 start ========================= -->
    <section id="home" class="hero-section-wrapper-5">
      <!-- ========================= header-6 start ========================= -->
      <header class="header header-6">
        <div class="navbar-area">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-lg-12">
                <nav
                  class="navbar navbar-expand-lg"
                  style="border-bottom: 2px solid #e3e3e7"
                >
                  <a
                    class="navbar-brand"
                    href="https://www.martechcloud.in/home"
                  >
                    <img
                      src="assets/img/logo/Martech Cloud Logo2.png"
                      alt="Logo"
                    />
                  </a>
                  <button
                    class="navbar-toggler"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent6"
                    aria-controls="navbarSupportedContent6"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                  >
                    <span class="toggler-icon"></span>
                    <span class="toggler-icon"></span>
                    <span class="toggler-icon"></span>
                  </button>

                  <div
                    class="collapse navbar-collapse sub-menu-bar"
                    id="navbarSupportedContent6"
                  >
                    <ul id="nav6" class="navbar-nav ms-auto align-items-center">
                      <li class="nav-item me-3">
                        <a class="page-scroll" href="#0" id="newOrderBtn"
                          >New Order</a
                        >
                      </li>
                      <li class="nav-item me-3">
                        <a class="page-scroll" href="product.html">Inventory</a>
                      </li>
                      <a
                        href="#0"
                        title="Logout"
                        onclick="googleLogout()"
                        class="icon-btn logout"
                        ><i class="lni lni-exit"></i
                      ></a>
                    </ul>

                    <!-- Header Action Icons -->
                  </div>
                  <!-- navbar collapse -->
                </nav>
                <!-- navbar -->
              </div>
            </div>
            <!-- row -->
          </div>
          <!-- container -->
        </div>
        <!-- navbar area -->
      </header>
      <!-- ========================= header-6 end ========================= -->

      <!-- ========================= hero-5 start ========================= -->
      <div class="hero-section hero-style-5 img-bg" id="table-selection">
        <div class="container">
          <!-- Table Status Legend -->
          <div class="legend-container">
            <div class="legend-item">
              <span
                class="legend-color"
                style="background-color: #e3e3e7"
              ></span>
              <span>Blank Table</span>
            </div>
            <div class="legend-item">
              <span
                class="legend-color"
                style="background-color: #d94b86"
              ></span>
              <span>Selected Table</span>
            </div>
            <div class="legend-item">
              <span
                class="legend-color"
                style="background-color: #fbda62"
              ></span>
              <span>Locked Table</span>
            </div>
            <div class="legend-item">
              <span
                class="legend-color"
                style="background-color: #28a745"
              ></span>
              <span>Running Table</span>
            </div>
          </div>

          <!-- Table Buttons -->
          <div class="row">
            <div class="d-flex flex-wrap" style="gap: 4px">
              <!-- 20 Tables -->
              <button id="table-btn-1" class="table-btn" data-table="1">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  1
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-2" class="table-btn" data-table="2">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  2
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-3" class="table-btn" data-table="3">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  3
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-4" class="table-btn" data-table="4">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  4
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-5" class="table-btn" data-table="5">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  5
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-6" class="table-btn" data-table="6">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  6
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-7" class="table-btn" data-table="7">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  7
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-8" class="table-btn" data-table="8">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  8
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-9" class="table-btn" data-table="9">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  9
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-10" class="table-btn" data-table="10">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  10
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-11" class="table-btn" data-table="11">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  11
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-12" class="table-btn" data-table="12">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  12
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-13" class="table-btn" data-table="13">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  13
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-14" class="table-btn" data-table="14">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  14
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>

              <button id="table-btn-15" class="table-btn" data-table="15">
                <div
                  class="time-label"
                  style="font-size: 12px; color: #fff"
                ></div>
                <div
                  class="table-number"
                  style="font-size: 20px; font-weight: 600"
                >
                  15
                </div>
                <div
                  class="subtotal-amount"
                  style="font-size: 12px; color: #fff"
                ></div>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Info Section -->
      <div
        class="hero-section hero-style-5 img-bg"
        id="order-info"
        style="display: none; padding: 100px 0"
      >
        <div class="container">
          <div class="row g-4">
            <!-- Left: Product Cards -->
            <div class="col-md-8">
              <div class="top-bar">
                <!-- Search Bar -->
                <div class="search-box input-group">
                  <span class="input-group-text bg-light border-end-0">
                    <i class="lni lni-search"></i>
                  </span>
                  <input
                    type="text"
                    id="search-bar"
                    class="form-control border-start-0 shadow-none"
                    placeholder="Search for items..."
                    oninput="searchItems()"
                  />
                </div>

                <!-- Buttons -->
                <div class="main-content1">
                  <button class="btn category-btn" onclick="showItems('bulk')">
                    Bulk
                  </button>
                  <button class="btn category-btn" onclick="showItems('kulfi')">
                    Kulfi
                  </button>
                  <button
                    class="btn category-btn"
                    onclick="showItems('takeaways')"
                  >
                    Takeaways
                  </button>
                  <button
                    class="btn category-btn"
                    onclick="showItems('cornatto')"
                  >
                    Cornatto
                  </button>
                  <button
                    class="btn category-btn"
                    onclick="showItems('default')"
                  >
                    Default
                  </button>
                </div>
              </div>

              <div
                class="product-section"
                style="
                  padding-top: 15px;
                  padding-bottom: 15px;
                  border-top: 2px solid #e3e3e7;
                  border-bottom: 2px solid #e3e3e7;
                "
              >
                <div class="d-flex flex-wrap" style="gap: 15px">
                  <div class="product-card border-left-green">
                    <p class="product-name">Aloo Tikki Burger</p>
                  </div>

                  <div class="product-card border-left-green">
                    <p class="product-name">Cheese Garlic Bread</p>
                  </div>

                  <div class="product-card border-left-red">
                    <p class="product-name">Chicken Angara (Boneless)</p>
                  </div>

                  <div class="product-card border-left-green">
                    <p class="product-name">Paneer Roll</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Right: Billing Summary -->
            <div class="col-md-4">
              <div class="billing-summary">
                <div
                  class="top-bar2"
                  style="
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    flex-wrap: wrap;
                    padding-top: 20px;
                    padding-bottom: 20px;
                    font-size: 15px;
                  "
                >
                  <button
                    class="btn btn-outline-danger shadow-sm px-2.5 py-1 rounded-pill fw-semibold"
                    id="reset-btn"
                    style="font-size: 15px"
                  >
                    <i class="lni lni-trash"></i> Reset
                  </button>

                  <button
                    class="btn btn-outline-secondary shadow-sm px-2.5 py-1 rounded-pill fw-semibold"
                    id="draft-btn"
                    style="font-size: 15px"
                  >
                    <i class="lni lni-save"></i> Draft
                  </button>

                  <button
                    class="btn btn-outline-success shadow-sm px-2.5 py-1 rounded-pill fw-semibold"
                    onclick="completeOrder()"
                    id="completeorder-btn"
                    style="font-size: 15px"
                  >
                    <i class="lni lni-checkmark-circle"></i> Complete
                  </button>

                  <button
                    class="btn btn-outline-warning shadow-sm px-2.5 py-1 rounded-pill fw-semibold"
                    onclick="printbill()"
                    id="completeorder-btn"
                    style="font-size: 15px"
                  >
                    <i class="lni lni-printer"></i> Print
                  </button>
                </div>

                <table class="styled-table">
                  <thead>
                    <tr>
                      <th>ITEM</th>
                      <th>QTY</th>
                      <th>TOTAL</th>
                      <th>FREEWILL</th>
                      <th>WAVE%</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                  <tfoot>
                    <tr>
                      <td colspan="5" class="text-center">
                        <label class="fw-semibold me-2">Payment Type:</label>
                        <label class="me-2"
                          ><input
                            type="radio"
                            name="paymentType"
                            value="Cash"
                            checked
                          />
                          Cash</label
                        >
                        <label class="me-2"
                          ><input type="radio" name="paymentType" value="UPI" />
                          UPI</label
                        >
                        <label
                          ><input
                            type="radio"
                            name="paymentType"
                            value="Card"
                          />
                          Card</label
                        >
                      </td>
                    </tr>
                    <tr style="border-bottom: 1.5px solid #d94b86">
                      <td colspan="5">
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <select
                            id="bill-discount"
                            class="form-select form-select-sm text-center discount-select"
                            style="width: 90px; font-size: 12px"
                          >
                            <option value="0">Discount %</option>
                            <option value="5">5%</option>
                            <option value="10">10%</option>
                            <option value="15">15%</option>
                            <option value="20">20%</option>
                          </select>

                          <!-- Round Off -->
                          <input
                            type="number"
                            id="round-off"
                            class="form-control form-control-sm text-end round-off-input"
                            style="width: 90px"
                            placeholder="Round Off"
                          />

                          <div class="subtotal-box text-end fw-bold">
                            Subtotal: ₹<span id="subtotal">0.00</span>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========================= hero-5 end ========================= -->
    </section>

    <!-- ========================= footer style-4 start ========================= -->
    <footer class="footer footer-style-4">
      <div class="container">
        <div class="copyright-wrapper wow fadeInUp" data-wow-delay=".1s">
          <p>
            Design and Developed by
            <a href="https://martechcloud.in" rel="nofollow" target="_blank"
              >Martech Cloud</a
            >
          </p>
        </div>
      </div>
    </footer>

    <!-- ========================= scroll-top start ========================= -->
    <a href="#" class="scroll-top"> <i class="lni lni-chevron-up"></i> </a>
    <!-- ========================= scroll-top end ========================= -->

    <!-- JavaScript -->

    <!-- ############################################################################################ -->
    <!--  -->
    <script type="module" src="pos/highlightsavedtables.js"></script>
    <script type="module" src="pos/locktable.js"></script>
    <script type="module" src="pos/unlocktable.js"></script>
    <script type="module" src="pos/neworderbutton.js"></script>
    <script type="module" src="pos/draftedbillingpopulation.js"></script>
    <script type="module" src="pos/addtocart.js"></script>
    <script type="module" src="pos/renderproducts.js"></script>
    <script type="module" src="pos/draftorder.js"></script>
    <script type="module" src="pos/resetorder.js"></script>
    <script src="pos/printbill.js"></script>
    <script type="module" src="pos/completeorder.js"></script>
    <script type="module" src="billingauthentication.js"></script>
    <script type="module" src="pos/fetchcustomerdata.js"></script>

    <!-- ########################################################################################## -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/bootstrap-5.0.0-beta1.min.js"></script>
    <script src="assets/js/tiny-slider.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
      // --- Change quantity and update total ---
      function changeQty(button, delta) {
        const row = button.closest("tr");
        const qtyInput = row.querySelector(".qty-value");
        const basePrice = getBasePrice(row);
        let newQty = parseInt(qtyInput.value) + delta;

        // Allow quantity 0 and remove product
        if (newQty <= 0) {
          row.remove(); // Remove the product row
          updateSubtotal(); // Recalculate subtotal
          return;
        }

        qtyInput.value = newQty; // Update quantity
        updateRowTotal(row, basePrice); // Update total for that row
      }

      // --- Toggle freewill (makes price 0) ---
      function toggleFreewill(checkbox) {
        const row = checkbox.closest("tr");
        const basePrice = getBasePrice(row);
        const qty = parseInt(row.querySelector(".qty-value").value);

        if (checkbox.checked) {
          row.querySelector(".total").textContent = "₹0.00";
        } else {
          updateRowTotal(row, basePrice);
        }

        updateSubtotal();
      }

      // --- Get base price of product ---
      function getBasePrice(row) {
        const productName = row.children[0].textContent.trim();
        const products = JSON.parse(sessionStorage.getItem("products") || "[]");
        const product = products.find((p) => p.PRODUCT_NAME === productName);
        return parseFloat(product?.PRODUCT_PRICE || 0);
      }

      // --- Update total per row ---
      function updateRowTotal(row, basePrice) {
        const qty = parseInt(row.querySelector(".qty-value").value);
        const wave = parseFloat(row.querySelector(".wave-select").value);
        const freewill = row.querySelector(".freewill-checkbox").checked;

        let total = qty * basePrice;
        total = total - (total * wave) / 100;
        if (freewill) total = 0;

        row.querySelector(".total").textContent = "₹" + total.toFixed(2);
        updateSubtotal();
      }

      // --- Calculate subtotal considering discount & round-off ---
      function updateSubtotal() {
        const rows = document.querySelectorAll(".styled-table tbody tr");
        let subtotal = 0;

        rows.forEach((row) => {
          const totalText = row
            .querySelector(".total")
            .textContent.replace("₹", "");
          subtotal += parseFloat(totalText) || 0;
        });

        const discount = parseFloat(
          document.getElementById("bill-discount").value
        );
        const roundOff =
          parseFloat(document.getElementById("round-off").value) || 0;

        subtotal = subtotal - (subtotal * discount) / 100;
        subtotal = subtotal + roundOff;

        document.getElementById("subtotal").textContent = subtotal.toFixed(2);
      }

      // --- Event listeners for footer elements ---
      document
        .getElementById("bill-discount")
        .addEventListener("change", updateSubtotal);
      document
        .getElementById("round-off")
        .addEventListener("input", updateSubtotal);
    </script>
  </body>
</html>
